async function CheckDuplicateInLockBlock(n){try{console.log("CheckDuplicateInLockBlock","begin");var t=await navigator.locks.request("my_resource",()=>pushToDuplicateListAndRun(n));return console.log("CheckDuplicateInLockBlock","end"),t}catch(i){console.log("CheckDuplicateInLockBlock","error:"+i)}}function pushToDuplicateListAndRun(n){return myDubList.indexOf(n)>=0?!1:(myDubList.push(n),myDubList.length>20&&myDubList.shift(),!0)}function checkForRestartSignalR(){firstRunFunction==!1?mySignalRListener.wsconn.state.toString().toLowerCase()!="connected"?(mySignalRListener=new signalRListener,userIsStoreManager&&setListenerToSignalR()):$(".chat h5.chatpage").html("Rasa IT"):firstRunFunction=!1}function uuidv4(){return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(n^crypto.getRandomValues(new Uint8Array(1))[0]&15>>n/4).toString(16))}var mySignalRListener,signalRListenerThis,beforeCallId="",isCaller=!1,ring=new Audio("/ringsound.mp3"),ding,myDubList,firstRunFunction,checkSignalrConnectivity;ring.setAttribute("allow","autoplay");ring.loop=!1;ding=new Audio("/dingsound.mp3");ding.setAttribute("allow","autoplay");ding.loop=!1;class signalRListener{constructor(){signalRListenerThis=this;this.sendNotConnectMess=!1;this.isDebugging=!0;this.hubUrl="/storeHub";this.wsconn=(new signalR.HubConnectionBuilder).withUrl(this.hubUrl,signalR.HttpTransportType.WebSockets).withAutomaticReconnect({nextRetryDelayInMilliseconds:()=>(checkForRestartSignalR(),1e6)}).configureLogging(signalR.LogLevel.None).build();this.initializeSignalR();this.wsconn.onclose(n=>{n?(console.log("SignalR: closed with error."),console.log(n)):console.log("Disconnected"),checkForRestartSignalR()});this.wsconn.on("RecieveAcceptCartInCustomer",n=>{CheckDuplicateInLockBlock(n).then(function(n){n&&(ding.play(),mySignalRListener.RecieveAcceptCartInCustomerFn())})});this.wsconn.on("NotFoundOnlineStore",n=>{CheckDuplicateInLockBlock(n).then(function(n){n&&mySignalRListener.NotFoundOnlineStoreFn()})})}RecieveAcceptCartInCustomerFn(){ding.play();ding.loop=!1;window.location.href="/payment"}NotFoundOnlineStoreFn(){alertify.confirm("یافت نشد","در آدرس انتخابی شما فروشگاه آنلاینی یافت نشد!",function(){window.location.href="/adress"},function(){window.location.reload()}).set({closable:!1,labels:{ok:"تغییر آدرس",cancel:"دوباره جست و جو کن"}})}initializeSignalR(){this.wsconn.start().then(()=>(this.InvokeProcess(InvokeSender.JoinUser,"123",1),console.log("signalr started!"))).catch(n=>console.log(n))}errorHandler(n){n.message?alertify.alert("<h4>Error Occurred<\/h4><\/br>Error Info: "+JSON.stringify(n.message)).set({title:"Rasa IT"}).set({delay:5e3}):alertify.alert("<h4>Error Occurred<\/h4><\/br>Error Info: "+JSON.stringify(n)).set({title:"Rasa IT"}).set({delay:5e3});this.consoleLogger(n)}consoleLogger(n){this.isDebugging&&console.log(n)}InvokeProcess(n,t,i,r,u,f,e,o,s,h){var a,c,l;(i==1||i==2||i==3||i==4)&&n!=InvokeSender.SendSignal&&n!=InvokeSender.HangUp&&(a=i+1,setTimeout(function(){signalRListenerThis.InvokeProcess(n,t,a,r,u,f,e,o,s,h)},3e3));switch(n){case InvokeSender.SendCart:var c=r,v=u,y=f,p=e,w=o,b=s,k=h;this.wsconn.invoke("SendCart",t,c,v,y,p,k,w,b);break;case InvokeSender.AcceptCart:c=r;l=u;this.wsconn.invoke("AcceptCart",t,c,l);break;case InvokeSender.PaymentStatusCompeleted:c=r;l=u;this.wsconn.invoke("PaymentStatusCompeleted",t);break;case InvokeSender.JoinUser:this.wsconn.invoke("JoinUser",t)}}SendNotConnectAlert(n){alertify.confirm(n,function(n){n&&window.location.reload();this.sendNotConnectMess=!1}).set({title:"Rasa IT"}).set("closable",!1).set("labels",{ok:"Refresh",cancel:"Wait for now"})}}myDubList=[];const InvokeSender={SendCart:"SendCart",JoinUser:"JoinUser",AcceptCart:"AcceptCart",PaymentStatusCompeleted:"PaymentStatusCompeleted"};mySignalRListener=new signalRListener;firstRunFunction=!0;checkSignalrConnectivity=setInterval(function(){checkForRestartSignalR()},15e3);